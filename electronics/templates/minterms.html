<!DOCTYPE html>
{% load static %}
<html>
    <head>
<!--        <link type="text/css" rel="stylesheet" href="indexstyle.css">-->
        <link type="text/css" rel="stylesheet" href="{% static  'css/indexstyle.css' %}">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    </head>
    <body style="background-color: rgb(252, 252, 252);"> 
       <!--navbar-->
      <div class="topnav">
        <div class="logo">Digital Circuit Designer</div>
        <a class="active" href="#home">Expression</a>
        <a href="#news">Flip-Flops</a>
        <a href="#contact">Counter</a>
        <a href="#about">About</a>
      </div>      
      <div class="main">   <!--form-->
        <div class="login-page">
            <form action="" class="form" method="post">
                {% csrf_token %}
              <div class="var">
                <h3>Enter variable names</h3>
                <input type="text" id="var" name="varlist" value="{% for x in var %}{{x}} {% endfor %}">
              </div>
              <div class="minTerm">
                <h3>Enter min terms</h3>
                <input type="text" id="min" name="minterms" value="{% for x in min %}{{x}} {% endfor %}">
              </div>
              <div class="dnt-care">
                <h3>Enter dont care positions</h3>
                <input type="text" id="dcare" name="dont-care" value="{% for x in dont %}{{x}} {% endfor %}">
              </div>
              <button class="sub-btn" onclick="clickHandler()">Submit</button>
            </form>
        </div>
        <div class="left">
             <!--result page-->
           <div class="result">
             <h1 id="exp-title">Boolean expression</h1>
             <div id="bool-exp">{{exp}}</div>
           </div>
         <!--truth table-->
           <div class="truthtable">
             <h1>Truth Table</h1>
           </div>
        </div>
        
      </div>
        <script>
<!--          var variables = ["a","b"]-->
<!--          var minterms = [0,3]-->
<!--          var dontcare = [2]-->
           var prob = {{ problem|safe  }};
           console.log(prob);
          var variables = prob['varlist'];
          var minterms = prob['minterms'];
          var dontcare = prob['dontcare'];

          var r = variables.length
          var c = r+1
          const tdiv = document.querySelector("div.truthtable")
          var v = document.createTextNode("new")
          var tbl = document.createElement('table')
          tbl.className = "tbl"
          //header row creation
          var header = document.createElement('tr')
          //inserting all variables
          for(let i=0;i<c-1;i++){
            //creating single td 
            let varibale = document.createElement('th')
            varibale.innerText = variables[i]
            header.appendChild(varibale)
          }
          let o = document.createElement('th')
          o.innerText = "Output"
          header.appendChild(o)
          //appending header to tbl
          tbl.appendChild(header)
          /////////////////////// adding rest
          var n = Math.pow(2,r) 
          //now making other rows 
          for(let i=0;i<n;i++){
            var x = i
            console.log(x)
            //new table row
            let newrow = document.createElement('tr')
            var arr = [];
            for(let j=0;j<r;j++){
              arr.push(x & 1)
              x = x>>1
            }
            for(let j=r-1;j>=0;j--){
              let ele = document.createElement('td')
              ele.innerText = arr[j]
              newrow.appendChild(ele)
            }
            //adding output to row
            var outRow = document.createElement('tr')
            //taking output from minterms or dont care or zero
            var out;
            if(minterms.includes(i)){
              out = 1
            }else if(dontcare.includes(i)){
              out = "x"
            }else{
              out = 0
            }
            outRow.innerText = out;
            newrow.appendChild(outRow)
            //adding row to table
            tbl.appendChild(newrow)
          }
          //tbl add to table div

          tdiv.append(tbl)
        </script>
        <script>
            function clickHandler(){
              var variable = document.getElementById("var");
              var minterms = document.getElementById("min");
              var dontcare = document.getElementById("dcare");
              var varArr = variable.value.split(' ').map(String)
              var minArr = toArray(minterms);
              var dcareArr = toArray(dontcare);
              //json formatting
              var obj = {
                "variables":varArr,
                "minterms":minArr,
                "dontcares":dcareArr,

              };
              document.getElementById("var").value = varArr;
              document.getElementById("min").value = minArr;
              document.getElementById("dcare").value = dcareArr;
              console.log(obj);
            }

            function toArray(element){
              var data = element.value;
              if(data == "")
                {
                console.log('Empty literal');
                return ['X'];
                }
              var arr = data.split(' ').map(Number);
              console.log(arr);
              return arr
            }
          </script>
    </body>
</html>